# 项目笔记





## 1、需求和功能

### 分析需求

**用户故事模板**：作为一个角色的使用者，我可以做某个功能，如此有什么好处。【角色+功能+商业价值】

**个人博客系统的用户故事**：略



### 功能划分

角色：普通访客、管理员

对应角色功能：

| 角色             | 功能     | 功能详情                 |
| ---------------- | -------- | ------------------------ |
| 访客（查看博客） | 查看     | 分页查看所有博客         |
|                  |          | 快速查看博客的6种分类    |
|                  |          | 查看所有分类             |
|                  |          | 查看对应类下的博客列表   |
|                  |          | 查看标记博客的10个标签   |
|                  |          | 查看所有标签             |
|                  |          | 查看对应标签下的博客列表 |
|                  |          | 根据时间线来查看博客列表 |
|                  |          | 快速查看最新的推荐博客   |
|                  |          | 查看具体博客内容         |
|                  | 搜索     | 使用关键字全局搜索博客   |
|                  | 评论     | 在博客内容下进行评论     |
|                  | 赞赏     | 赞赏博客内容             |
|                  | 微信扫描 | 使用微信扫描查看博客内容 |
|                  |          | 扫描微信公众号关注       |
|                  |          |                          |
|                  |          |                          |
|                  |          |                          |
|                  |          |                          |



| 角色   | 功能     | 功能详情                     |
| ------ | -------- | ---------------------------- |
| 管理员 | 管理博客 | 发布、修改、删除博客         |
|        |          | 对博客分类                   |
|        |          | 对博客打标签                 |
|        |          | 根据标题、分类、标签查询博客 |
|        |          |                              |
|        |          |                              |
|        | 管理分类 | 新增、修改、删除分类         |
|        |          | 根据分类名称查询分类         |
|        |          |                              |
|        | 管理标签 | 新增、修改、删除标签         |
|        |          | 根据标签名称查询标签         |
|        |          |                              |
|        |          |                              |



### 系统架构

http://naotu.baidu.com/file/74bf1d5a0d6d610aeaaa60c9702ee0d4?token=f43ff61904292422

![个人博客系统架构](.\个人博客系统架构.png)



## 2、页面设计与开发

### 页面设计

页面原型设计使用Axuer进行设计，涉及到的页面包括：

- 前端
  - 首页
  - 详情页
  - 分类
  - 标签
  - 归档
  - 关于我
- 后端
  - 模板页



### 页面开发（前端开发）

- 前台页面开发
- 后台管理页面开发
- 插件集成
  - Markdown编辑器：Editor.md
  - 内容排版：typo.css
  - 动画效果：animate.css
  - 代码高亮：prismjs.css
  - 滚动侦测：waypoints
  - 平滑滚动：jquery.scrollTo
  - 目录生成：Tocbot
  - 二维码生成：qrcode.js



### Semantic UI用法

> 待填...
>
> 容器：布局
>
> 居中：上下居中、左右居中
>
> 组件：图标、按钮、导航条







## 3、后台框架搭建

### 配置环境

配置数据库连接、日志、配置活跃



遇到的问题：

数据库时区设置 serverTimezone=UTC 

yml数据库配置：

```yml
spring:
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://localhost:3306/blog?userUnicode=true&characterEncoding=utf-8&serverTimezone=UTC
    #注意不能是data-username
    username: root
    password: 123456
```



### 异常处理

1. 定义错误页面

   error目录下定义404.xml和500.xml

2. 全局处理异常

   Spring Boot会在发生异常时自动跳转到对应的错误页面

   如果需要跳转到自定义的错误页面，需要自己创建自定义拦截器handler



### 日志处理

记录日志内容：访问的url、访问者的ip、调用的方法、参数、方法返回的内容

记录日志类：根据AOP对Controller方法进行增强，将以上内容记录到日志中

​	可以将需要的信息通过内部类的形式保存，方便处理



### 页面处理

导入静态页面

使用thymeleaf布局

错误页面美化



## 4、设计规范

**实体设计**

- 博客Blog
  - 自体属性：标题、内容、首图、标记、浏览次数、赞赏开启、版权开启、评论开启、发布、推荐开启、创建时间、更新时间
  - 类关系：分类、标签、评论、用户
- 博客分类Type
  - 自体属性：名称
- 博客标签Tag
  - 自体属性：名称
- 博客评论Comment
  - 自体属性：昵称、邮箱、头像、评论内容、创建时间
- 用户User
  - 自体属性：昵称、用户名、密码、邮箱、类型、头像、创建时间、更新时间

**实体关系**

- 博客和分类为多对多关系
- 博客和标签为多对多关系
- 博客和用户为多对一关系
- 博客和评论为一对多关系

- 评论存在自关联关系

**应用分层**

- 终端显示层（View）
- 请求处理层（Web）
- 业务逻辑层（Service）
- 持久层（Dao）
- 数据源

**命名约定**

Service/Dao层命名约定：

- 获取单个对象的方法用get做前缀
- 获取多个对象的方法用list做前缀
- 获取统计值的方法用count做前缀
- 插入方法用save（推荐）或insert做前缀
- 删除方法用remove（推荐）或delete做前缀
- 修改的方法用update做前缀



具体步骤：

1. 构建实体类的基本属性和方法，完成和数据库的映射
2. 构建实体类和实体类之间的关系
3. 创建完后框架将自动创建对应表到配置的数据库中
4. 实现后端管理
5. 实现前端展示



## 5、后台管理

登录页面

MD5加密

登录拦截器

​	配置拦截器时需要实现WebMvcConfigurer接口，才能保证静态资源不被拦截

校验分三层：前端校验、Controller校验、实体类校验



分类管理

​	分类页面

​	分类列表分页

​	分类的新增、修改、删除

​	分类的校验，重复、非空等规则



标签管理：与分类管理同理



博客管理

1、博客分页查询

2、博客新增

3、博客修改

4、博客删除









# 代码分析

Java文件包

- po（Class）：实体类，里面对应有实体属性和实体之间的关系
- dao（Interface）：类直接操作数据库的方法，继承JpaRepostory，不要写具体的实现方法
- service（Interface + ClassImpl）：定义业务方法
- web（Controller的Class）：处理前端响应数据
- util：存放自定义的相关工具类
- exception：存放自定义的异常类，继承RuntimeException类
- aspect：存放自定义的AOP方法，需要添加AOP注解
- handler：前端控制器，可以设置异常跳转到自定义的错误页面，使用@ExceptionHandler注解
- interceptor：前端过滤器，自定义拦截器，需要继承HandlerInterceptorAdapter类，可以设定后台管理页面需要登录，需要将自定义拦截器通过配置添加到框架中，需要实现WebMvcConfigurer接口







# 待解决Bug

博客详情页面工具栏滚动显示问题

分类管理无法分页

操作完成组件关闭异常



第一次分类名发生重复无法验证，前端type最初没有值



